---
title: "Granger Casuality between Immigrant Population and Electoral Outcomes in US - From 1880 to 2000"
output: html_document
---

```{r include=FALSE}
library(quanteda)
library(qlcMatrix)
library(stringdist)
library(vars)
library(AER)
library(readxl)
library(stargazer)
library(scales)
library(quantmod)
library(urca)
library(sandwich)
library(lmtest)
library(forecast)
library(dyn)
library(rtweet) ; library(tidyverse) ; library(tidytext)
library(twitteR)
library(igraph)
library(stringr)
library(tidygraph)
library(ggraph)
library(stringi)
library(tidyr)
library(xts)
library(DescTools)
library(ggplot2)  # For graphics
library(dplyr)  # For aggregating
library(stringr)
library(wordcloud)
library(gdata)
library(dynlm)
require("reshape")
```


```{r}
#load csv

df <- read.csv('data.csv')
```

```{r}
#turn the 3 variables: 1. % of immigrants in US population 2. % of votes won by Democrats & 3.Republican Presidential candidates

dem <- ts(df$dem)
rep <- ts(df$rep)
immigrants <- ts(df$immigrants)
```

First, let's see the trends of the 3 variables from 1880 to 2000. 

```{r}
require("ggplot2")

mdf <- melt(df, id="year")  # convert to long format
ggplot(mdf, aes(x=year, y=value, colour=variable)) +
    geom_line() + 
    theme_bw()
```


One important step to take when conducting time-series analysis is to find the autocorrelation function (ACF) of the variables. In simple terms, ACF refers to the coefficient of correlation between a variable and its own past values in a time series. This step allows us to uncover hidden trends in the variables concerned - this may be important for forecasting tasks later. 

```{r}
acf(dem, main = "ACF for Dem", na.action = na.pass)
```
```{r}
acf(rep, main = "ACF for Rep", na.action = na.pass)
```
```{r}
acf(immigrants, main = "ACF for Immigrants", na.action = na.pass)
```

From the above three ACF graphs, we can see that the autoregression coefficients vary across different lags but in most cases it is only positive at the first lag (when the vertical bar at the first lag goes above zero). This however should not be much of a concern as none of these coefficients lays outside the dotted lines - beyond which a coefficient can be said as statistically significant. 

Once we have checked the ACF for the respective varaibles, we can then choose the optimal number of lags used in the mode. "Optimal" here means that it enables us to choose a lag length with the least noise and most reliable information. 

```{r}
#combine variables into a time series then find the optimal no. of lags using VARselect()

dem_im <- cbind(dem, immigrants)

lagselect_dem_im <- VARselect(dem_im, lag.max = 5, type = "const")
lagselect_dem_im$selection
```

```{r}
rep_im <- cbind(rep, immigrants)

lagselect_rep_im <- VARselect(rep_im, lag.max = 5, type = "const")
lagselect_rep_im$selection
```

The VARselect() function in R allows us to choose the optimal lag lengths by using 4 criteria - AIC, HQ, SC and FPE. In this particular case, all of the four criteria point to choosing 1 lag (which makes sense, given in this case one lag represents 20 years, which is a very long period of time.) We can now conduct the test for granger casuality with 1 lag (p=1).

```{r}
#build the model with 1 lag, then conduct the test for granger casuality for the variables

dem_im_model <- VAR(dem_im, p=1, type = "const", season = NULL, exogen = NULL) 
rep_im_model <- VAR(rep_im, p=1, type = "const", season = NULL, exogen = NULL)

dem_im_granger <- causality(dem_im_model, cause = "dem")
dem_im_granger
```
```{r}
rep_im_granger <- causality(rep_im_model, cause = "rep")
rep_im_granger
```
```{r}
#we then check the reverse direction of the granger casuality

im_dem_granger <- causality(dem_im_model, cause = "immigrants")
im_dem_granger

```
```{r}
im_rep_granger <- causality(rep_im_model, cause = "immigrants")
im_rep_granger
```

Recall that in a granger casuality test, the null hypothesis is that X does not Granger cause Y. If the p-value of the test goes below 0.05, we can reject the null hypothesis - in other words, X Granger causes Y. In the four tests above, none of the p-value is lower than 0.05. Therefore, we cannot reject the null hypothesis. 

In order to delve further into the relationship between variables, we may also use the impulse-response function (IRF). This method is popular amongst ecnoometricians when assessing a particular policy's overall impact. For instance, whether a tax cut (the impulse) can stimulate economic growth (the response) and if so, when and to what extent it will happen. In our case, IRF is helpful for us to examine if and how the change in immigration population in the US will affect the electoral outcomes of Presidential elections, and vice versa. 

```{r}
im_dem_irf <- irf(dem_im_model, impulse = "immigrants", response = "dem", n.ahead = 10, ortho = FALSE)
plot(im_dem_irf)
```
```{r}
im_dem_irf <- irf(dem_im_model, impulse = "immigrants", response = "dem", n.ahead = 5, ortho = FALSE)
plot(im_dem_irf)
```

```{r}
rep_im_irf <- irf(rep_im_model, impulse = "rep", response = "immigrants", n.ahead = 5, ortho = FALSE)
plot(rep_im_irf)
```
```{r}
im_rep_irf <- irf(rep_im_model, impulse = "immigrants", response = "rep", n.ahead = 5, ortho = FALSE)
plot(im_rep_irf)
```

From the IRF graphs above, on interesting finding can be observed. In the "Immigrants -> Republicans" model, it seems to suggest that a positive change in the immigrant population will actually stimulate a positive change in votes won by the Republican Party in Presidential Elections (the response takes place in the second lag). Conversely, in the "Immigrants -> Democrats" model, more immigrants would actually predict less electoral gains for the Democratic Party. This may seem counter-intuitive to some as in the most simplistic terms, the Democratic Party has been more supportive of a liberal immigration regime in the US but, if the finding in this study holds true, this policy may actually hurt its electoral performance at least in Presidential Elections. Of course one should look at this finding with more caution as none is statistically significant (did not go below the dotted lines in the IRF graphs). 

Moving forward, there are a few ways to improve this model. First, the interval in this dataset is 20 years - which may be too large for researchers to observe the nuances between Presidential Elections, which take place every 4 years (of course, one may also argue that for immigration to take a real effect on electoral politics it will take more than 4 years or in some instances even a generation, so perhaps after all 20 years a time lag is not too out of the place - but with more data in between we can always test and see if something interesting emerges out of a different model with shorter time lags). In addition, future research may also look at other elections such as mid-term elections, state elections etc. Further, immigrant communities are very diverse and could have very different political orientations among them. Looking into specific immigrant groups may also be helpful to better understand how these populations may shape US politics in the years/ decades to come. 